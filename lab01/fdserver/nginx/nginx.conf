proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=all:32m max_size=1g;
client_body_buffer_size 10M;
client_max_body_size 10M;

upstream servers {
    server service1:8080 fail_timeout=50s max_fails=5 weight=2;
    server service2:8080 fail_timeout=50s max_fails=5;
    server service2:8080 fail_timeout=50s max_fails=5;
}
server {
    listen 9090;
    server_name fdsystem.com www.fdsystem.com;

    proxy_cache all;
    proxy_cache_valid any 1h;

    gzip on;
    gzip_comp_level 2;
    gzip_disable "msie6";
    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;

    add_header server fdsystem;

    location / {
            root /data/www;
    }


    location /test {
        proxy_pass http://servers/welcome; # redirect
    }

    location /status {
        stub_status;
    }

    location /images/ {
        root /data;
    }

    location /admin {
        rewrite ^/admin$ http://localhost:8086 redirect;
#         proxy_pass http://localhost:8086;
#         rewrite `^/databasets/(.*) /$1 break`;
#         proxy_set_header Host $host;
    }

    # В общем))) Это не работает. Вот Вам крест: https://github.com/springfox/springfox/issues/3680
    # И ещё один: https://github.com/springfox/springfox/issues/1921
    # I've tried my fucking best
    location = /api {
        proxy_no_cache 1;
        return 301 $scheme://$http_host/swagger-ui/index.html;
    }

    location /api/v1/ {
        proxy_pass http://servers/api;
    }
}

# http {
#     server {
#         location / {
#             root /data/www;
#         }
#
#         location /images/ {
#             root /data;
#         }
#     }
# }